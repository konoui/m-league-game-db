## 説明
全期間の試合別リーチ回数合計上位10件を算出するクエリ

## SQL クエリ
```sql
WITH game_players AS (
    SELECT 
        g.id AS game_id,
        p.name AS player_name,
        ROW_NUMBER() OVER (PARTITION BY g.id ORDER BY gpr.player_id) AS player_order
    FROM game g
    JOIN game_player_result gpr ON g.id = gpr.game_id
    JOIN player p ON gpr.player_id = p.id
),
game_reach_counts AS (
    SELECT 
        g.id AS game_id,
        ls.start_year,
        ss.stage,
        g.date,
        g.match_number,
        COUNT(re.event_id) AS reach_count,
        COUNT(DISTINCT k.id) AS kyoku_count
    FROM game g
    JOIN season_stage ss ON g.season_stage_id = ss.id
    JOIN league_season ls ON ss.league_season_id = ls.id
    JOIN kyoku k ON g.id = k.game_id
    LEFT JOIN event e ON k.id = e.kyoku_id AND e.type = 'reach'
    LEFT JOIN reach_event re ON e.id = re.event_id
    GROUP BY g.id, ls.start_year, ss.stage, g.date, g.match_number
)
SELECT 
    grc.start_year AS シーズン年,
    grc.stage AS ステージ,
    grc.date AS 試合日,
    grc.match_number AS 試合番号,
    MAX(CASE WHEN gp.player_order = 1 THEN gp.player_name END) AS プレイヤー1,
    MAX(CASE WHEN gp.player_order = 2 THEN gp.player_name END) AS プレイヤー2,
    MAX(CASE WHEN gp.player_order = 3 THEN gp.player_name END) AS プレイヤー3,
    MAX(CASE WHEN gp.player_order = 4 THEN gp.player_name END) AS プレイヤー4,
    grc.reach_count AS リーチ回数合計,
    grc.kyoku_count AS 総局数
FROM game_reach_counts grc
JOIN game_players gp ON grc.game_id = gp.game_id
GROUP BY grc.game_id, grc.start_year, grc.stage, grc.date, grc.match_number, grc.reach_count
ORDER BY リーチ回数合計 DESC, シーズン年 DESC, ステージ, 試合日 DESC
LIMIT 10;
```

## 参照テーブル
- game
- season_stage
- league_season
- game_player_result
- player
- kyoku
- event
- reach_event
